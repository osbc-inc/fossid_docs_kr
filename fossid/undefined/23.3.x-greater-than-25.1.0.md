# 23.3.x -> 25.1.0

## Workbench Server 업데이트 지침

![](https://fossid.osbc.co.kr/help/en/images/security.svg)

### 가정 <a href="#assumptions" id="assumptions"></a>

* 현재 사용 중인 Workbench 버전은 <mark style="color:red;">22.2.x 이상</mark>입니다.\
  <mark style="color:red;">→ 만약 23.1 버전보다 이전 버전을 사용 중이라면, 먼저 22.2.x로 업데이트한 후 이 지침을 따르세요.</mark>\
  (23.1 버전 미만인 경우, 아래의  <mark style="color:green;">22.2로 업데이트하기 위한 선택적 준비</mark>를 참고하세요.)
* 업데이트대상 버전은 <mark style="color:red;">2025.1.0</mark>입니다.
* 기존 Workbench는 `/fossid` 디렉토리에 설치되어 있습니다.
* 데이터베이스 테이블 `permissions`와 `role_permission`은 수정되지 않았습니다.





### 패키지 변경 <a href="#package-changes" id="package-changes"></a>

버전 23.3부터 FossID Workbench 로그를 rotate할 수 있는 기능이 추가되었습니다.



### OS 요구 사항 <a href="#os-requirements" id="os-requirements"></a>

FossID Workbench는 다음에서 지원됩니다.

* Debian 11
* Debian 12
* Ubuntu 20.04
* Ubuntu 22.04
* Ubuntu 24.04
* RedHat Enterprise Linux 8 and 9
* RedHat Enterprise Linux Server 8 and 9



* 필수 'PHP' 최소 버전 <mark style="color:red;">: PHP 8.2 이상</mark>
* 필수 '데이터베이스' 서버 최소 버전 :&#x20;
  * <mark style="color:red;">MySQL Server 8.0 또는 MariaDB 10.6</mark>
  * 단, 모든 하위 시스템은 아직 유지 관리(보안 및 업데이트 지원)가 이루어지고 있는 버전 이상을 사용하는 것이 좋습니다.





### 22.2로 업데이트하기 위한 선택적 준비 (선택사항)  <a href="#optional-preparation-for-updating-to-222" id="optional-preparation-for-updating-to-222"></a>

<mark style="color:green;">23.1 미만 버전을 사용 중이라면 해당 부분을 참고하세요.</mark>\


* 23.1.x 버전보다 이전 버전에서 22.2 또는 최신 버전으로 Workbench를 업데이트할 경우,\
  특정 데이터베이스 변경 작업 때문에 데이터베이스가 큰 경우 업데이트에 매우 오랜 시간이 걸릴 수 있습니다.  &#x20;
* 업데이트가 진행되는 동안에는 웹 애플리케이션을 사용할 수 없습니다.
* 업데이트를 빠르게 진행하려면, 업데이트 전에 직접 데이터베이스에 접속하여 아래 SQL 문장을 실행할 수 있습니다.

```
ALTER TABLE "file_client_results" MODIFY "file_license" mediumtext NULL;
```





### PHP 전제 조건 <a href="#php-prerequisites" id="php-prerequisites"></a>

*   만약 <mark style="color:red;">FossID 서버가 다음 중 하나의 운영체제에서 실행 중이라면,</mark>\
    <mark style="color:red;">PHP 8.2 이상을 설치할 수 있도록, 먼저</mark> <mark style="color:red;"></mark><mark style="color:red;">**PHP repository를 추가**</mark>해야 합니다.

    * **Debian 11**
    * **Ubuntu 20.04**
    * **Ubuntu 22.04**
    * **RedHat 8**
    * **RHEL Server 8**



\-----------------------------------------------------------------------------------------------------------------------

**Debian 11 -** PHP 8.2 저장소 추가 및 설정

```
sudo apt update
sudo apt install lsb-release apt-transport-https ca-certificates -y
sudo wget -O /etc/apt/trusted.gpg.d/php.gpg https://packages.sury.org/php/apt.gpg
echo "deb https://packages.sury.org/php/ $(lsb_release -sc) main" | sudo tee /etc/apt/sources.list.d/php8.2.list
sudo apt update
sudo apt remove php7\*
sudo apt remove php8.0\*
```

**Ubuntu 20.04 또는 Ubuntu 22.04 -** PHP 8.2 저장소 추가 및 설정

```
sudo add-apt-repository ppa:ondrej/php -y
sudo apt update
sudo apt remove php7\*
sudo apt remove php8.0\*
```

&#x20;Debian과 Ubuntu 모두에서, 위의 **`apt remove` 명령은 시스템에 설치된 정확한 PHP 버전에 따라 수정**되어야 할 수 있습니다.

> **참고:** 일부 Debian 또는 Ubuntu 시스템에서는 패키지 관리 방식 때문에, 사용 중인 PHP 버전에 필요한 모든 PHP 패키지들이 자동으로 설치되지 않을 수 있습니다.\
> -> 이런  경우에는 [문제 해결 페이지를](https://fossid.osbc.co.kr/help/en/installation/webapp_troubleshooting.html) 확인하세요 .



**RedHat 계열 시스템 (RedHat 8, RedHat 9)**

**RedHat의 \[Epel] repository**

**RedHat 9 -** Epel 저장소 추가

```
sudo yum install https://dl.fedoraproject.org/pub/epel/epel-release-latest-8.noarch.rpm -y
```

**RedHat 9 -** Epel 저장소 추가

```
sudo yum install https://dl.fedoraproject.org/pub/epel/epel-release-latest-9.noarch.rpm -y
```



**Remis의 \[RPM] repository**

**RedHat 8 -**  Remi 저장소 추가

```
sudo yum install -y https://rpms.remirepo.net/enterprise/remi-release-8.rpm
```

**RedHat 9 -**  Remi 저장소 추가

```
sudo yum install -y https://rpms.remirepo.net/enterprise/remi-release-9.rpm
```

\-----------------------------------------------------------------------------------------------------------------------

**패키지 설치 -** PHP8.2 모듈 활성화 및 패키지 설치

원하는 PHP 버전을 설정합니다(<mark style="color:red;">최소 요구 버전은 8.2</mark>입니다):

```
sudo yum module reset php
sudo yum module enable php:remi-8.2 -y
```

**RedHat 8 -**&#xD544;수 패키지 설치

```
sudo yum install php-cli php-fpm php-process mariadb-server mariadb \
php-mysqlnd php-zip php-xml php-curl php-ldap php-mbstring php-intl \
vim libxslt unzip java-11-openjdk-headless git p7zip p7zip-plugins perl -y

```

**RedHat 9 -** 필수 패키지 설치

```
sudo yum install php-cli php-fpm php-process mariadb-server mariadb \
php-mysqlnd php-zip php-xml php-curl php-ldap php-mbstring php-intl \
vim libxslt

```

\-----------------------------------------------------------------------------------------------------------------------

**MySQL/MariaDB 업그레이드**

[MySQL 또는 MariaDB의 다양한 배포판에서 이전 버전이 사용되므로 https://dev.mysql.com/doc/refman/8.0/en/installing.html](https://dev.mysql.com/doc/refman/8.0/en/installing.html) 에 있는 공식 가이드를 사용하여 최소 MySQL 8.0으로 업그레이드하는 것이 좋습니다. MariaDB 10.6의 경우 [https://mariadb.com/kb/en/binary-packages/](https://mariadb.com/kb/en/binary-packages/) 에서 업그레이드하는 것이 좋습니다 .

참고: MySQL/MariaDB 구성 파일에서 문자 집합 및 정렬에 대한 다음 값을 명시적으로 설정하는 것이 좋습니다.

```
character-set-server     = utf8mb4
collation-server         = utf8mb4_general_ci
```

MySQL 복제의 경우 매개변수를 . `default_collation_for_utf8mb4`로 설정해야 합니다 `utf8mb4_general_ci`. 자세한 내용은 [https://dev.mysql.com/doc/refman/8.0/en/server-system-variables.html#sysvar\_default\_collation\_for\_utf8mb4를 참조하세요.](https://dev.mysql.com/doc/refman/8.0/en/server-system-variables.html#sysvar_default_collation_for_utf8mb4)

MySQL 서버 배포판(예: 또는 ) 의 해당 파일에서 under 태그에 최소 값을 `64M`설정해야 합니다 . 아래 참조를 참조하세요.`max_allowed_packet[mysqld]/etc/mysql/my.cnf/etc/my.cnf`

```
[mysqld]
max_allowed_packet = 64M
```

이는 Linux 배포판과 MySQL 서버 배포판에 따라 다를 수 있습니다. 해당 Linux 및 MySQL 버전 배포판의 설명서를 참조하세요.

MySQL을 다시 시작하세요:

```
sudo service mysql restart
```

### 액세스 제공물 <a href="#access-deliverables" id="access-deliverables"></a>

FossID 전달물에 대한 접근 정보는 배달 메일에 제공됩니다.

### 패키지를 설치하세요 <a href="#install-the-package" id="install-the-package"></a>

#### DEB 설치 프로그램 <a href="#deb-installer" id="deb-installer"></a>

```
sudo apt install ./fossid-release_regular_amd64-{VERSION}.deb -y
sudo systemctl restart php$(php -r 'echo PHP_MAJOR_VERSION.".".PHP_MINOR_VERSION;')-fpm.service
```

#### RPM 설치 프로그램 <a href="#rpm-installer" id="rpm-installer"></a>

```
sudo yum localinstall ./fossid-release_regular.x86_64-{VERSION}.rpm -y
```

#### fossid.conf 업데이트 <a href="#update-fossidconf" id="update-fossidconf"></a>

**FossID Workbench 23.3부터 이전에 Microsoft OAuth2 로그인을 사용했다면 여러 ID 공급자를 지원하기 위해 일부 매개변수의 이름이 바뀌거나 추가되었으므로 fossid.conf에서 변경 작업을 해야 합니다.**

1. "webapp\_microsoft\_oauth2\_login"이 "webapp\_oauth2\_login"으로 이름이 바뀌었습니다.
2. “webapp\_microsoft\_oauth2\_fallback\_local\_login”이 “webapp\_oauth2\_fallback\_local\_login”으로 이름이 바뀌었습니다.
3. fossid.conf에 webapp\_oauth2\_provider="Microsoft" 매개변수를 추가해야 합니다.

**FossID Workbench 21.2부터는 fossid.conf 설정을 마이그레이션할 필요가 없으며 권장되지 않습니다. Workbench는 기존 21.2 이전 구성과 함께 작동합니다.**

어떤 이유로든 이전 설정을 새 템플릿으로 마이그레이션하려는 경우 방법은 다음과 같습니다.

1. 기존 `/fossid/etc/fossid.conf`파일을 eg에 백업합니다.`fossid.conf_bak`
2. `/fossid/etc/fossid.conf.dist`이름 을 바꾸다`/fossid/etc/fossid.conf`
3. `/fossid/etc/fossid.conf`구성에 맞게 새 파일을 수정하세요.`fossid.conf_bak`

**워크벤치 URL 구성**

이 정보는 이메일에서 올바른 절대 URL을 생성하는 데 사용됩니다.

```
webapp_base_url = https://mycompany.com/index.php
```

fossid.conf 파일을 저장합니다.

참고: 구성 변경 사항은 즉시 적용되므로 재시작이 필요하지 않습니다.

### 설치 후 작업 <a href="#post-install-actions" id="post-install-actions"></a>

#### 데이터베이스 업데이트 <a href="#update-database" id="update-database"></a>

22.2 버전부터 중복 데이터를 피하기 위해 데이터베이스 수준에서 새로운 고유 제약 조건이 추가되었습니다.

기존 중복 항목을 식별하고 수정하려면 다음 명령을 /fossid/webapp 디렉토리에서 실행해야 합니다.

```
cd /fossid/webapp
sudo -u www-data php bin/console.php enforce_data_integrity
```

대화형 명령줄 인터페이스가 프로세스를 안내합니다. 중복된 라이선스 또는 구성 요소의 경우, 스크립트는 식별자를 하나의 레코드에 재할당하고 중복된 레코드를 제거하여 식별자가 손실되지 않도록 중복을 수정하는 데 도움을 줍니다. 프로젝트/스캔/사용자의 경우, 접미사를 추가하여 중복된 항목을 수정합니다.

```
The system checks if there is a duplicates in DataBase tables: 
'licenses'; 
'projects'; 
'components'; 
'scans'; 
'users'; 
----------------------- 
The system didn't find duplicates. Do you want to add UNIQUE CONSTRAINTS to the tables? (defaults to yes)
  [0] yes
  [1] no
  > 0
```

가장 좋은 시나리오는 중복 항목이 발견되지 않고 고유 제약 조건을 직접 추가할 수 있다는 것입니다. 중복 항목이 발견되면 다음 메시지가 표시됩니다.

```
"The system found duplicates in the next tables:"
'projects'
'licenses'
----------------------- 
Do you want to clean duplicates? (defaults to yes)
  [0] yes
  [1] no
 > 0
```

다음 표와 열은 데이터의 고유성을 확인하는 데 사용됩니다.

```
  Table       unique by    Column(s)
 'projects'                'project_code' 
 'licenses'                'identifier' 
 'components'              'name' and  'version' 
 'scans'                   'code', 
 'users'                   'username'  
```

발견된 중복을 수정하려면 대화형 CLI에 표시되는 지침을 따르세요. 마지막 단계는 해당 테이블에 고유 제약 조건을 추가하는 것입니다. 고유 키가 이미 존재하는 경우 오류 메시지가 표시됩니다.

```
The system didn't find duplicates. Do you want to add UNIQUE CONSTRAINTS to the tables? (defaults to yes)
  [0] yes
  [1] no
 > 0
The system tries to add UNIQUE CONSTRAINT 'uc_identifier' to table: 'licenses' on column: `identifier`.
SQLSTATE[42000]: Syntax error or access violation: 1061 Duplicate key name 'uc_identifier'
```

고유 키가 이미 있으므로 다른 조치를 취할 필요가 없습니다.

**릴리스 20.1 이전에 작성된 구성 요소 식별 정보를 마이그레이션하려면 한 번의 작업이 필요합니다.**

20.1 릴리스 이전에는 식별된 파일당 하나의 구성 요소만 식별로 지정할 수 있었습니다. 아래 명령을 한 번 실행하면 "identifications" 테이블의 "component\_id" 열에 있는 이전 구성 요소 식별을 "identification\_component" 테이블로 마이그레이션할 수 있습니다. "identifications.component\_id" 열은 24.3 릴리스에서 dbupdate.php 스크립트에 의해 제거되었습니다.

```
sudo -u www-data php bin/console.php migrate_legacy_identifications --auto_migrate
```

**23.1.x 이전 버전에서 업데이트하는 경우 한 번만 작업이 필요합니다.**

```
sudo -u www-data php bin/console.php split_file_client_results
```

스캔당 테이블이 `file_client_results`하나씩 분할됩니다. 이렇게 하면 스캔이 삭제될 때 삭제된 스캔과 관련된 테이블을 삭제하여 MySQL에서 디스크 공간을 즉시 확보하여 데이터베이스 유지 관리 부담을 줄일 수 있습니다 . 이름이 '와(과) 같은' 테이블이 생성되었는지 `file_client_results_x`확인하세요 .`file_client_results_SCAN_ID`

초기 테이블은 `file_client_results`해당 이름으로 여전히 존재하며 `old_file_client_results`, 새 테이블이 생성되고 데이터가 마이그레이션되었는지 확인한 후 수동으로 삭제할 수 있습니다.

중복을 수정하고 `split_file_client_results`명령을 실행한 후 일반 업그레이드 프로세스를 계속합니다.

설치 폴더로 이동합니다.

```
cd /fossid/setup/database
```

아래 쿼리를 사용하여 모든 테이블에 or `row_format`로 설정되어 있는지 확인하고 , 그렇지 않은 경우 아래의 more 명령문을 사용하여 수동으로 변경해야 합니다 .`DYNAMICCOMPRESSEDALTER TABLE`

각 테이블 에 설정 `row_format`되어 있는지 확인하려면 :`DYNAMICCOMPRESSED`

```
SELECT table_name, row_format FROM information_schema.tables WHERE table_schema=DATABASE();
```

필요한 경우 테이블을 수동으로 수정하려면(아래 예에서는 로 설정됨 `DYNAMIC`):

```
ALTER TABLE [table_name] ROW_FORMAT=DYNAMIC;
```

인덱스를 설정하고 데이터베이스 구조를 확인하세요.

```
sudo -u www-data php dbupdate.php /fossid/etc/fossid.conf
```

필요한 모든 데이터(역할 및 권한 등)가 있는지 확인하고 이전 역할/권한을 제거합니다.

```
sudo -u www-data php db_info_update.php /fossid/etc/fossid.conf
```

라이선스 데이터베이스를 업데이트하세요:

```
sudo -u www-data php licenseupdate.php --no-update --no-disable /fossid/etc/fossid.conf
```

인수에 주의하세요. `--no-update`및 `--no-disable`는 선택 사항입니다.

* `--no-update`: 기본 데이터베이스에 포함된 라이선스의 라이선스 텍스트를 편집했고 해당 편집 내용을 유지하려면 이 인수를 사용하세요. 이 인수를 사용해도 잘못된 라이선스 식별자가 수정되는 것을 막을 수는 없습니다. --no-fix-idents를 참조하세요.
* `--no-disable`: 기본 데이터베이스에 포함되지 않은 라이선스를 수동으로 추가했고 이러한 라이선스로 파일을 계속 식별하려는 경우 또는 SPDX 표준에 따라 더 이상 사용되지 않는 것으로 표시된 식별자로 파일을 계속 식별하려는 경우 이 인수를 사용합니다.
* `--no-fix-idents`: –no-fix-idents 옵션은 이 유틸리티가 데이터베이스에서 발견된 잘못된 식별자나 오래된 식별자를 업데이트하지 않도록 합니다. 이미 존재하는 일부 라이선스가 다시 삽입될 수 있으므로 –no-insert 옵션을 함께 사용하지 않는 한 이 옵션을 활성화하지 않는 것이 좋습니다.
* `--dry-run`: 어떠한 수정도 하지 말고, 단지 무엇이 수행될 것인지 보여주세요.

licenseupdate.php 매뉴얼 전체를 보려면 다음을 실행하세요.

```
php licenseupdate.php --help
```

**KB에서 제공하는 선택적 PURL 및 CPE 업데이트**

Workbench 23.1에서 PURL 필드가 추가되었습니다. Workbench 데이터베이스에 이미 있는 구성 요소의 KB에서 이 필드를 채우려면 다음 명령을 실행하세요. 또한 로컬 구성 요소의 이 필드가 비어 있는 경우 이 명령은 KB에서 CPE 정보를 채웁니다.

```
cd /fossid/webapp
sudo -u www-data php bin/console.php add_purl_and_cpe
```

#### 종속성 분석을 위한 OSS 검토 툴킷 업데이트 <a href="#update-oss-review-toolkit-for-dependency-analysis" id="update-oss-review-toolkit-for-dependency-analysis"></a>

FossID Workbench 사용자 인터페이스에서 바로 패키지 종속성과 라이선스 정보를 제공하는 데 사용할 수 있는 FossID-DA 또는 OSS Review Toolkit 두 가지 도구가 있습니다. 종속성 분석 기능을 사용하면 소프트웨어가 준수해야 하는 라이선스에 대한 더 나은 통찰력을 얻을 수 있습니다. FossID는 종속성 분석 API도 제공하므로 지속적 통합 파이프라인에 포함할 수 있습니다.

Workbench 24.3 릴리스 이후 FossID-DA 도구가 기본 종속성 분석 도구로 사용됩니다. FossID-DA에 대한 자세한 내용은 [여기의 관련 문서 섹션을 참조하세요.](https://fossid.osbc.co.kr/help/en/fda/FossID-DA-Getting-Started.html)

ORT는 최근 API 변경을 거쳤으며, 이 버전의 FossID Workbench를 사용하려면 최신 버전으로 업데이트해야 합니다. 배포 포털의 설치 패키지를 사용하여 이전 버전의 ORT를 설치한 경우, 먼저 이전 버전을 제거하고 `/fossid/lib/ort`폴더를 삭제해야 합니다. 그런 다음 배포 포털에서 새 ORT 버전(22.2)을 다운로드하여 설치하십시오.

RHEL에서 제거하려면 다음을 실행하세요.

```
sudo yum remove fossid-ort
sudo rm -rf /fossid/lib/ort
```

Debian/Ubuntu의 경우:

```
sudo apt remove fossid-ort
sudo rm -rf /fossid/lib/ort
```

소스 코드에서 ORT를 빌드한 경우 최신 변경 사항을 가져와서 다시 빌드하세요.

자세한 내용은 [설치 - 종속성 분석을](https://fossid.osbc.co.kr/help/en/installation/dependency-analysis.html) 참조하세요 .

nginx 설정 변경 사항\
\
23.3.0 릴리스에서는 새로운 nginx 위치와 재작성이 추가되었습니다. 설정을 확인하고 /fossid/setup/templates/nginx.conf 파일의 예시와 동기화하세요.

\


#### PHP 업그레이드 시 필요한 변경 사항 <a href="#changes-required-when-upgrading-php" id="changes-required-when-upgrading-php"></a>

PHP를 업그레이드한 경우 다음과 같이 변경하세요.

를 열고 `/etc/nginx/nginx.conf`다음 섹션을 찾으세요.

```
location = /index.php {
    # If any other php version than 8.2 is used, please update this path
    fastcgi_pass unix:/run/php/php8.2-fpm.sock;
    include fastcgi_params;
    fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
    fastcgi_param SCRIPT_NAME $fastcgi_script_name;
}
```

올바른 PHP 버전을 가리키도록 변경하세요 `fastcgi_pass unix:/run/php/php8.2-fpm.sock;`. 예를 들어, PHP 버전이 8.3이면 다음과 같습니다.

```
fastcgi_pass unix:/run/php/php8.3-fpm.sock;
```

nginx 서비스를 다시 시작합니다.

```
sudo service nginx restart
```

편집 `/etc/php-fpm.d/www.conf`하고 다음 구성이 설정되어 있는지 확인하세요.

```
user = www-data
group = www-data
listen = /run/php/php8.2-fpm.sock
listen.owner = www-data
listen.group = www-data
listen.mode = 0660
;listen.acl_users = apache,nginx   <-- make sure it's commented out.
```

올바른 PHP 버전을 가리키도록 변경하세요 `listen = /run/php/php8.2-fpm.sock`. 예를 들어, PHP 버전이 8.3이면 다음과 같습니다.

```
listen = /run/php/php8.3-fpm.sock
```

그룹 소유권을 변경한 `/var/lib/php`후 php-fpm을 다시 시작합니다.

```
sudo chgrp www-data /var/lib/php/*
sudo systemctl restart php-fpm
```

#### 로그 회전 <a href="#log-rotation" id="log-rotation"></a>

Fossid Workbench 23.3부터 로그 순환에 필요한 파일을 추가했습니다 `/fossid/logs`. 파일을 편집하여 사용 필요에 맞게 구성을 조정할 수 있습니다 `/etc/logrotate.d/fossid-workbench`.

#### 오래된 crontab 항목 제거 <a href="#remove-old-crontab-entries" id="remove-old-crontab-entries"></a>

FossID 21.2부터는 `crontab`백그라운드 작업(취약점 모니터링 및 검사 대기열 처리)에 더 이상 사용되지 않습니다. 백그라운드 작업이 구성된 설치를 업그레이드하는 경우 다음을 실행하세요.

```
sudo crontab -e
```

다음과 유사한 항목을 삭제하세요.

```
* * * * *  /fossid/www/webapp/scans_queue_consumer.sh
0 1 * * *  /fossid/www/webapp/cpe_update_check.sh
0 0 * * *  /fossid/www/webapp/monitor.php --check v --n
```

#### 선택 사항: 허용 목록 <a href="#optional-whitelisting" id="optional-whitelisting"></a>

FossID 20.2부터 허용 목록 기능은 기본적으로 활성화되어 있지 않습니다. 허용 목록을 활성화하려면 다음 매개변수를 `webapp_cli_command`in 에 추가하세요 `fossid.conf`. `--fields +mid` 예:

```
webapp_cli_command=/fossid/bin/fossid-cli --config /fossid/etc/fossid.conf --fields +mid
```

허용 목록이 활성화되기 전에 이미 검사된 파일은 해당 파일에서 허용 목록 규칙을 추가하려면 다시 검사해야 합니다.
